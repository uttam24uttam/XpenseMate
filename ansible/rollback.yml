---
# Playbook to rollback deployment
- name: Rollback Splitwise Application
  hosts: localhost
  connection: local
  gather_facts: no
  
  vars:
    k8s_namespace: "splitwise"
    
  tasks:
    - name: Rollback backend deployment
      command: kubectl rollout undo deployment/backend -n {{ k8s_namespace }}
      register: backend_rollback

    - name: Rollback frontend deployment
      command: kubectl rollout undo deployment/frontend -n {{ k8s_namespace }}
      register: frontend_rollback

    - name: Wait for rollback to complete
      command: kubectl rollout status deployment/{{ item }} -n {{ k8s_namespace }}
      loop:
        - backend
        - frontend
      register: rollback_status

    - name: Display rollback status
      debug:
        msg: "Rollback completed: {{ rollback_status }}"
